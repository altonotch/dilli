{% extends "admin/change_list.html" %}
{% load i18n %}

{% block content %}
  {% if queue %}
    <div class="module">
      <h2>{% trans "Moderation Queue" %}</h2>
      <form method="post" action="">
        {% csrf_token %}
        <input type="hidden" name="from_queue" value="1">
        <table class="adminlist">
          <thead>
            <tr>
              <th>{% trans "Select" %}</th>
              <th>{% trans "Report" %}</th>
              <th>{% trans "Session data" %}</th>
              <th>{% trans "Tools" %}</th>
            </tr>
          </thead>
          <tbody>
          {% for entry in queue %}
            <tr>
              <td><input type="checkbox" name="_selected_action" value="{{ entry.report.pk }}"></td>
              <td>
                <strong>{{ entry.report.product }}</strong><br>
                {{ entry.report.store }}<br>
                {{ entry.report.price }} ₪ · {{ entry.report.units_in_price }} {% trans "units" %}<br>
                {% if entry.report.is_for_club_members_only %}{% trans "Club members only" %}<br>{% endif %}
                {% if entry.report.min_cart_total %}{% trans "Min cart" %}: {{ entry.report.min_cart_total }} ₪<br>{% endif %}
                {% if entry.report.deal_notes %}{{ entry.report.deal_notes }}<br>{% endif %}
              </td>
              <td>
                {% if entry.session_data %}
                  <pre>{{ entry.session_data|pprint }}</pre>
                {% else %}
                  {% trans "No session data" %}
                {% endif %}
              </td>
              <td>
                <a class="button" href="{% url 'admin:pricing_pricereport_fix' entry.report.pk %}?next={{ request.get_full_path|urlencode }}">{% trans "Fix data" %}</a><br>
                <a href="{% url 'admin:pricing_pricereport_change' entry.report.pk %}">{% trans "Open report" %}</a><br>
                {% if entry.report.store %}
                  <a href="{% url 'admin:stores_store_change' entry.report.store.pk %}" target="_blank" rel="noopener">{% trans "Edit store" %}</a>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
        <div>
          <label>{% trans "Action" %}:
            <select name="action">
              <option value="mark_reports_approved">{% trans "Approve selected price reports" %}</option>
              <option value="mark_reports_rejected">{% trans "Reject selected price reports" %}</option>
            </select>
          </label>
          <label>{% trans "Rejection reason" %}: <input type="text" name="rejection_reason"></label>
          <button type="submit" class="button">{% trans "Execute" %}</button>
        </div>
      </form>
    </div>
  {% endif %}
  {{ block.super }}
{% endblock %}
